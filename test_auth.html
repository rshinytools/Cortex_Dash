<!DOCTYPE html>
<html>
<head>
    <title>Test Auth</title>
</head>
<body>
    <h1>Testing Authentication</h1>
    <button onclick="testLogin()">Test Login</button>
    <button onclick="checkAuth()">Check Auth</button>
    <button onclick="clearAuth()">Clear Auth</button>
    <div id="result"></div>

    <script>
        async function testLogin() {
            const result = document.getElementById('result');
            
            try {
                // Login
                const formData = new URLSearchParams();
                formData.append('username', 'admin@sagarmatha.ai');
                formData.append('password', 'adadad123');
                
                const loginResponse = await fetch('http://localhost:8000/api/v1/login/access-token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData.toString(),
                });
                
                const loginData = await loginResponse.json();
                console.log('Login response:', loginData);
                
                if (loginData.access_token) {
                    localStorage.setItem('auth_token', loginData.access_token);
                    
                    // Get user details
                    const userResponse = await fetch('http://localhost:8000/api/v1/users/me', {
                        headers: {
                            'Authorization': `Bearer ${loginData.access_token}`,
                        },
                    });
                    
                    const userData = await userResponse.json();
                    console.log('User data:', userData);
                    localStorage.setItem('auth_user', JSON.stringify(userData));
                    
                    result.innerHTML = '<pre>' + JSON.stringify({
                        token: loginData.access_token,
                        user: userData
                    }, null, 2) + '</pre>';
                }
            } catch (error) {
                result.innerHTML = 'Error: ' + error.message;
                console.error('Login error:', error);
            }
        }
        
        function checkAuth() {
            const token = localStorage.getItem('auth_token');
            const user = localStorage.getItem('auth_user');
            
            document.getElementById('result').innerHTML = '<pre>' + JSON.stringify({
                hasToken: !!token,
                token: token ? token.substring(0, 50) + '...' : null,
                user: user ? JSON.parse(user) : null
            }, null, 2) + '</pre>';
        }
        
        function clearAuth() {
            localStorage.removeItem('auth_token');
            localStorage.removeItem('auth_user');
            document.getElementById('result').innerHTML = 'Auth cleared';
        }
    </script>
</body>
</html>